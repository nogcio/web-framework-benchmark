use std::collections::HashMap;
use std::sync::OnceLock;

static MANIFEST: OnceLock<HashMap<String, String>> = OnceLock::new();

fn load_manifest() -> HashMap<String, String> {
    // Generated by build.rs
    let raw = include_str!(concat!(env!("OUT_DIR"), "/assets-manifest.json"));
    serde_json::from_str(raw).unwrap_or_default()
}

pub fn resolve(logical_path: &str) -> Option<String> {
    let key = logical_path.trim_start_matches('/');
    let manifest = MANIFEST.get_or_init(load_manifest);
    manifest.get(key).cloned()
}
